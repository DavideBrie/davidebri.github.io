<p>I discovered this protocol by doing a <a href="https://hackthebox.eu">HTB</a>â€™s room which involved a Windows-based machine, and it was my very first time hacking that OS.</p>

<h1 id="introduction">Introduction</h1>

<p>Also known as <strong>Server Message Block</strong>, is a client-server protocol, originally created by IBM than updated by Microsoft, that allow access to shared file, printers and ports over the network. <br />
We mostly see SMB services running on Windows machines. <br />
User side, SMB authentication requires a username and password to allow access to the server. It is controlled by the system administrator, who can add or block users and keep tabs on who is allowed in. <br />
Meanwhile at share-level,users have to enter a one-time password to access the shared file or server, but no username is required.</p>

<h2 id="different-version">Different Version</h2>

<p>There are different variations of this protocol:</p>

<ul>
  <li>
    <p>SMBv1, released by IBM and modified by Microsoft, this version is also known because the ransomware <a href="https://en.wikipedia.org/wiki/WannaCry_ransomware_attack">Wannacry</a> used a vulnerability of this version to spread itself over the network.</p>
  </li>
  <li>
    <p>SMBv2, performance boosted - debuted in Windows Vista</p>
  </li>
  <li>
    <p>SMBv3, security increased like end-to-end encryption - introduced in Windows 7</p>
  </li>
  <li>
    <p>SMBv3.02, possibility to completely disable SMBv1- came with Windows 8.1</p>
  </li>
  <li>
    <p>SMBv3.1.1, introduced AES-128 encryption, mitm protection and session verification - released in Windows 10</p>
  </li>
</ul>

<h3 id="how-to-use-smb">How to use SMB</h3>

<p>Fisrt of all we should know that it operate via TCP on port 445. If we are operating from a Linux machine the command to see the shares is :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smbclient <span class="nt">-L</span> <span class="o">{</span>HOSTNAME<span class="o">}</span>
</code></pre></div></div>
<p>This will output something like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Server <span class="nb">time </span>is Sat Aug 10 15:58:27 1996
Timezone is UTC+10.0
Password: 
<span class="nv">Domain</span><span class="o">=[</span>WORKGROUP] <span class="nv">OS</span><span class="o">=[</span>Windows NT 3.51] <span class="nv">Server</span><span class="o">=[</span>NT LAN Manager 3.51]

<span class="nv">Server</span><span class="o">=[</span>ZIMMERMAN] <span class="nv">User</span><span class="o">=[]</span> <span class="nv">Workgroup</span><span class="o">=[</span>WORKGROUP] <span class="nv">Domain</span><span class="o">=[]</span>

        Sharename      Type      Comment
        <span class="nt">---------</span>      <span class="nt">----</span>      <span class="nt">-------</span>
        ADMIN<span class="nv">$ </span>        Disk      Remote Admin
        public         Disk      Public 
        C<span class="nv">$ </span>            Disk      Default share
        IPC<span class="nv">$ </span>          IPC       Remote IPC
        OReilly        Printer   OReilly
        print<span class="nv">$ </span>        Disk      Printer Drivers


This machine has a browse list:

        Server               Comment
        <span class="nt">---------</span>            <span class="nt">-------</span>
        HOPPER               Samba 1.9.15p8
        KERNIGAN             Samba 1.9.15p8
        LOVELACE             Samba 1.9.15p8
        RITCHIE              Samba 1.9.15p8
        ZIMMERMAN            

</code></pre></div></div>

<p>If you want to reach the public directory on the ZIMMERMAN machine we have tio type:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smbclient <span class="se">\\\\</span>ZIMMERMAN<span class="se">\\</span>public
</code></pre></div></div>
<p>It may ask you for a password.</p>

<p>Once we are connected we can do a bunch of operation, type <code class="language-plaintext highlighter-rouge">smb: \&gt; help</code> for more info.</p>
